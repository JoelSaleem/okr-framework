# Migration `20200627130606`

This migration has been generated by JoelSaleem at 6/27/2020, 1:06:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."KeyResult" DROP CONSTRAINT IF EXiSTS "KeyResult_parentKeyResId_fkey",
DROP CONSTRAINT IF EXiSTS "KeyResult_parentObjId_fkey",
DROP COLUMN "parentKeyResId",
DROP COLUMN "parentObjId",
ADD COLUMN "objectiveId" integer   ;

ALTER TABLE "public"."Objective" ADD COLUMN "parentId" integer   ;

ALTER TABLE "public"."KeyResult" ADD FOREIGN KEY ("objectiveId")REFERENCES "public"."Objective"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Objective" ADD FOREIGN KEY ("parentId")REFERENCES "public"."Objective"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200627112827..20200627130606
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgres {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 // This "Example" model has been generated for you by Nexus.
 // Nexus does this when you do not have any models defined.
@@ -14,25 +14,25 @@
   description String?
   createdAt   DateTime
   user        User        @relation(fields: [userId], references: [id])
   userId      Int
-  KeyResult   KeyResult[]
+  keyResults  KeyResult[]
+  parentObj   Objective?  @relation(fields: [parentId], references: id)
+  parentId    Int?
+  Objective   Objective[] @relation("ObjectiveToObjective")
 }
 model KeyResult {
-  id              Int         @id @default(autoincrement())
-  title           String
-  description     String?
-  createdAt       DateTime
-  target          Int
-  current         Int
-  user            User        @relation(fields: [userId], references: [id])
-  userId          Int
-  parentObjective Objective?  @relation(fields: [parentObjId], references: [id])
-  parentResult    KeyResult?  @relation(fields: [parentKeyResId], references: [id])
-  parentObjId     Int?
-  parentKeyResId  Int?
-  KeyResult       KeyResult[] @relation("KeyResultToKeyResult")
+  id          Int        @id @default(autoincrement())
+  title       String
+  description String?
+  createdAt   DateTime
+  target      Int
+  current     Int
+  user        User       @relation(fields: [userId], references: [id])
+  userId      Int
+  objective   Objective? @relation(fields: [objectiveId], references: [id])
+  objectiveId Int?
 }
 model User {
   id         Int         @id @default(autoincrement())
```


